{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transacciones</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'styles/transacciones.css' %}">
    

</head>
<body>
    <div style="display: block">

        <!-- Menú superior (antes sidebar) -->
        <div class="sidebar">
            <div class="py-4 text-center logo">
                <a href="/"><img src="{% static 'img/home.png' %}" alt="home"></a>
            </div>
            <a href="/catalogo_cuentas" class="aclass">Catálogo de Cuentas</a>
            <a href="/transacciones" class="aclass">Transacciones</a>
            <a href="/control_costos" class="aclass">Control de Costos</a>
            <a href="/estados_financieros" class="aclass">Estados Financieros</a>
            <a href="logout" class="logout-link">Cerrar sesión</a>
        </div>

        <div class="content text-center" name="transaccion">
            <h2>Transacciones</h2>

            <!-- ===== Tarjeta unificada: filtro + acciones + tabla ===== -->
            <div class="card toolbar-card mx-auto">
              <div class="card-body">

                <!-- Filtro de período -->
                <form method="post" action="{% url 'filtrar_transacciones' %}" class="form-row align-items-end">
                    {% csrf_token %}
                    <div class="form-group col-md-8 mb-2">
                        <label for="periodo-select" class="font-weight-bold mb-1">Seleccionar Período</label>
                        <select class="form-control" id="periodo-select" name="periodo-select">
                            <option value="todos">Ninguno</option>
                            {% for periodo in periodos %}
                                <option value="{{ periodo.codigo }}">{{ periodo.nombre }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4 mb-2">
                        <button type="submit" class="btn btn-primary btn-block">Buscar Periodo</button>
                    </div>
                </form>

                <!-- Acciones -->
                <div class="toolbar-actions d-flex flex-wrap mt-2 mb-3">
                    <button class="btn btn-secondary mr-2 mb-2" data-toggle="modal" data-target="#nuevoPeriodoModal">Nuevo período</button>
                    <button class="btn btn-primary mr-2 mb-2" data-toggle="modal" data-target="#agregarTransaccion">Agregar Transacción</button>
                    <a href="#" class="btn btn-dark mr-2 mb-2" data-toggle="modal" data-target="#totalizar">Totalizar</a>
                    <a href="libro_mayor" class="btn btn-dark mb-2">Ver Libro Mayor</a>
                </div>

                <!-- Tabla de transacciones dentro del mismo recuadro -->
                <div class="table-responsive">
                  <table class="table table-striped table-dark table-bordered mt-2 mb-0" id="transaccionesTable">
                      <thead>
                          <tr>
                              <th>Código</th>
                              <th>Fecha</th>
                              <th>Descripción</th>
                              <th>Debe</th>
                              <th>Haber</th>
                              <th style="width: 160px;">Acciones</th>
                          </tr>
                      </thead>
                      <tbody>
                          {% for transaccion in transacciones %}
                              <tr>
                                  <td>{{ transaccion.codigo }}</td>
                                  <td>{{ transaccion.fecha }}</td>
                                  <td>{{ transaccion.descripcion }}</td>
                                  <td>${{ transaccion.movimiento_debe }}</td>
                                  <td>${{ transaccion.movimiento_haber }}</td>
                                  <td>
                                    <a href="{% url 'modificar_transaccion' transaccion.id %}" class="btn btn-info btn-sm" data-toggle="modal" data-target="#modificarTransaccion{{ transaccion.id }}">Modificar</a>
                                    <a href="{% url 'eliminar_transaccion' transaccion.id %}" class="btn btn-danger btn-sm">Eliminar</a>
                                  </td>
                              </tr>

                              <!-- Modal modificar -->
                              <div class="modal fade" id="modificarTransaccion{{ transaccion.id }}" tabindex="-1" role="dialog" aria-labelledby="modificarTransaccion{{ transaccion.id }}" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="modificarTransaccion{{ transaccion.id }}">Modificar Transacción</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <form method="post" action="{% url 'modificar_transaccion' transaccion.id %}">
                                                    {% csrf_token %}
                                                    <div class="form-group">
                                                        <label for="codigo">Código:</label>
                                                        <select class="form-control" id="codigo" name="codigo" required>
                                                            {% for cuenta in cuentas %}
                                                            <option value="{{ cuenta.codigo }}" {% if cuenta.codigo == transaccion.codigo.codigo %}selected{% endif %}>
                                                                {{ cuenta.codigo }} - {{ cuenta.nombre}}
                                                            </option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="fecha">Fecha:</label>
                                                        <input type="date" class="form-control" id="fecha" name="fecha" value="{{ transaccion.fecha }}" required />
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="descripcion">Descripción:</label>
                                                        <input type="text" class="form-control" id="descripcion" name="descripcion" value="{{ transaccion.descripcion }}" required />
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="movimiento_debe2">Movimiento (Debe):</label>
                                                        <input type="text" class="form-control" id="movimiento_debe" name="movimiento_debe" value="{{ transaccion.movimiento_debe }}"/>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="movimiento_haber2">Movimiento (Haber):</label>
                                                        <input type="text" class="form-control" id="movimiento_haber" name="movimiento_haber" value="{{ transaccion.movimiento_haber }}" />
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="periodo">Período:</label>
                                                        <select class="form-control" id="periodo" name="periodo" required>
                                                            {% for periodo in periodos %}
                                                                <option value="{{ periodo.codigo }}" {% if periodo.codigo == transaccion.codigo.codigo %}selected{% endif %}>{{ periodo.nombre }}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                                                        <button type="submit" class="btn btn-primary" id="editarTransaccion{{ transaccion.id }}">Guardar</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                          {% endfor %}
                      </tbody>
                      <tfoot>
                          <tr>
                              <td colspan="3">
                                <center> Total </center>
                            </td>
                              <td>${{ suma_debe }}</td>
                              <td>${{ suma_haber }}</td>
                              <td></td>
                          </tr>
                        </tfoot>
                  </table>
                </div>

              </div>
            </div>
            <!-- ===== Fin tarjeta unificada ===== -->

        </div>
    </div>

    <!-- Modal Totalizar -->
    <div class="modal fade" id="totalizar" tabindex="-1" role="dialog" aria-labelledby="totalizar" aria-hidden="true">
      <div class="modal-dialog" role="document">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title" id="totalizar">Totalizar</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                  </button>
              </div>
              <div class="modal-body">
                  <form method="post" action="{% url 'actualizar_resumen_cuentas' %}">
                      {% csrf_token %}
                      <div class="form-group">
                        <label for="periodo">Período:</label>
                        <select class="form-control" id="periodo" name="periodo" required>
                            {% for periodo in periodos %}
                                <option value="{{ periodo.codigo }}">{{ periodo.nombre }}</option>
                            {% endfor %}
                        </select>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Totalizar</button>
                      </div>
                  </form>
              </div>
          </div>
      </div>
    </div>

    <!-- Modales restantes -->
    <div class="modal fade" id="nuevoPeriodoModal" tabindex="-1" role="dialog" aria-labelledby="nuevoPeriodoModal" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="nuevoPeriodoModal">Nuevo período</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form method="post" action="{% url 'crear_periodo' %}">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="nombre">Nombre del período:</label>
                            <input type="text" class="form-control" id="nombre" name="nombre_periodo" required />
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-primary">Guardar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="agregarTransaccion" tabindex="-1" role="dialog" aria-labelledby="agregarTransaccion" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="agregarTransaccion">Agregar Transaccion</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form method="post" action="{% url 'agregar_transaccion' %}">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="codigo">Código:</label>
                            <select class="form-control" id="codigo" name="codigo" required>
                                {% for cuenta in cuentas %}
                                    <option value="{{ cuenta.codigo }}">{{ cuenta.codigo }} - {{ cuenta.nombre }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="fecha">Fecha:</label>
                            <input type="date" class="form-control" id="fecha" name="fecha" required />
                        </div>
                        <div class="form-group">
                            <label for="descripcion">Descripción:</label>
                            <input type="text" class="form-control" id="descripcion" name="descripcion" required />
                        </div>
                        <div class="form-group">
                            <label for="movimiento_debe2">Movimiento (Debe):</label>
                            <input type="text" class="form-control" id="movimiento_debe2" name="movimiento_debe" required />
                        </div>
                        <div class="form-group">
                            <label for="movimiento_haber2">Movimiento (Haber):</label>
                            <input type="text" class="form-control" id="movimiento_haber2" name="movimiento_haber" required />
                        </div>
                        <div class="form-group">
                            <label for="periodo">Período:</label>
                            <select class="form-control" id="periodo" name="periodo" required>
                                {% for periodo in periodos %}
                                    <option value="{{ periodo.codigo }}">{{ periodo.nombre }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-primary" id="agregarTransaccion">Guardar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#movimiento_debe2").on("input", function () {
                if ($(this).val() !== "") {
                    $("#movimiento_haber2").prop("disabled", true);
                } else {
                    $("#movimiento_haber2").prop("disabled", false);
                }
            });

            $("#movimiento_haber2").on("input", function () {
                if ($(this).val() !== "") {
                    $("#movimiento_debe2").prop("disabled", true);
                } else {
                    $("#movimiento_debe2").prop("disabled", false);
                }
            });
        });
    </script>
     <!-- Luego DataTables -->
  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">
<script src="{% static 'js/tabla.js' %}"></script>


<footer>
     <p>Derechos reservados 2025. Sistemas Contables UES </p>

</footer>
</body>
</html>


<style>
/* 🔹 Fondo general del contenedor DataTables */
.dataTables_wrapper {
  background-color: #212529; /* mismo fondo que table-dark */
  color: #fff;
  padding: 10px;
  border-radius: 8px;
}

/* 🔹 Labels "Mostrar X registros" y "Buscar" */
.dataTables_length label,
.dataTables_filter label {
  color: #fff !important;
}

/* 🔹 Select de cantidad de registros */
.dataTables_length select {
  background-color: #343a40 !important;
  color: #fff !important;
  border: 1px solid #555 !important;
  border-radius: 4px;
  padding: 4px;
}

/* 🔹 Input del buscador */
.dataTables_filter input {
  background-color: #343a40 !important;
  color: #fff !important;
  border: 1px solid #555 !important;
  border-radius: 4px;
  padding: 4px 8px;
}

/* 🔹 Información inferior (Mostrando registros) */
.dataTables_info {
  color: #fff !important;
}

/* 🔹 Controles de paginación */
.dataTables_paginate .paginate_button {
  background-color: #343a40 !important;
  color: #fff !important;
  border: 1px solid #555 !important;
  border-radius: 4px;
  margin: 0 2px;
  padding: 4px 8px;
}

/* 🔹 Botón activo */
.dataTables_paginate .paginate_button.current {
  background-color: #495057 !important;
  color: #fff !important;
  border: 1px solid #777 !important;
}

/* 🔹 Hover en los botones de paginación */
.dataTables_paginate .paginate_button:hover {
  background-color: #495057 !important;
  color: #fff !important;
}

/* 🔹 Texto de "No hay datos disponibles" */
table.dataTable td.dataTables_empty {
  color: #fff !important;
  background-color: #2c3034 !important;
}
</style>
